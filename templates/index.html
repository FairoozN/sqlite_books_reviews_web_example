<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Shelf</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>

    <header class="navbar">
        <h1>Book Shelf</h1>

        <div id="searchSection">
            <input type="text" id="searchQuery" placeholder="Search by Title or Author" aria-label="Search Books">
            <button onclick="searchBooks()">Search</button>
        </div>
    </header>

    <main class="container">

        <!-- ADD BOOK SECTION -->
        <section id="addBook">
            <h2>Add a Book</h2>
            <input type="text" id="bookTitle" placeholder="Book Title">
            <input type="text" id="bookAuthor" placeholder="Author Name">
            <input type="text" id="publicationYear" placeholder="Publication Year">
            <input type="text" id="bookImage" placeholder="Image URL">
            <button onclick="addBook()">Add Book</button>
        </section>

        <!-- BOOK LIST SECTION -->
        <section id="bookList"></section>

        <!-- CONTROLS -->
        <section id="controls">
            <button id="showBooksButton" onclick="showAllBooks()">Show All Books</button>
        </section>

        <!-- BOOK DISPLAY GRID -->
        <section id="bookShelf" class="grid"></section>

    </main>

    <script src="{{ url_for('static', filename='script.js') }}"></script>

    <script>
        // --- FETCH BOOKS + REVIEWS FROM BACKEND ---
        async function loadBooksWithReviews() {
            const booksRes = await fetch("/books");
            const books = await booksRes.json();

            const reviewsRes = await fetch("/reviews");
            const reviews = await reviewsRes.json();

            const shelf = document.getElementById("bookShelf");
            shelf.innerHTML = "";

            books.forEach(book => {
                const bookReviews = reviews.filter(r => r.book_id === book.id);

                const div = document.createElement("div");
                div.classList.add("book-card");

                div.innerHTML = `
                    <img src="${book.image}" alt="${book.title}" class="book-img">

                    <h3>${book.title}</h3>
                    <p><strong>Author:</strong> ${book.author}</p>
                    <p><strong>Year:</strong> ${book.year}</p>

                    <h4>Reviews</h4>
                    <div class="reviews-box">
                        ${
                            bookReviews.length
                            ? bookReviews.map(r => `
                                <p><strong>${r.user}</strong> â€” ${r.rating}/5</p>
                                <p>${r.comment}</p>
                                <hr>
                            `).join("")
                            : "<p>No reviews yet.</p>"
                        }
                    </div>
                `;

                shelf.appendChild(div);
            });
        }

        // Load on page load
        loadBooksWithReviews();
    </script>

</body>
</html>
